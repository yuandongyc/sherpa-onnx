# 截图脚本文件夹创建计划

## 需求总结

1. 创建 `screenshot-scripts` 文件夹
2. 创建截图生成脚本 `generate-screenshots.js`
3. 复制 `transcription` 文件夹到 `transcription2`
4. 对于 .json 文件，只保留 "ready." 之后的内容

## 实施步骤

### 1. 创建截图脚本文件夹

```bash
mkdir screenshot-scripts
```

### 2. 创建截图生成脚本

在 `screenshot-scripts/generate-screenshots.js` 中：

```javascript
const fs = require('fs');
const path = require('path');

const paramsFile = 'transcription2/screenshot-params.json';
const outputDir = 'output/screenshots/video2';

const params = JSON.parse(fs.readFileSync(paramsFile, 'utf8'));

if (!fs.existsSync(outputDir)) {
  fs.mkdirSync(outputDir, { recursive: true });
}

const { execSync } = require('child_process');

params.screenshots.forEach((screenshot, index) => {
  const videoPath = params.videoPath;
  const timestamp = screenshot.timestamp;
  const filename = `screenshot_${String(index + 1).padStart(4, '0')}.jpg`;
  const outputPath = path.join(outputDir, filename);
  
  const cmd = `"${config.ffmpeg.path}" -i "${videoPath}" -ss ${timestamp} -vframes 1 "${outputPath}"`;
  execSync(cmd, { stdio: 'inherit' });
  
  console.log(`[${index + 1}/${params.screenshots.length}] Generated: ${filename}`);
});
```

### 3. 复制 transcription 文件夹

创建 `copy-transcription-files.js` 脚本：

```javascript
const fs = require('fs');
const path = require('path');

const sourceDir = 'transcription';
const targetDir = 'transcription2';

const files = fs.readdirSync(sourceDir);

for (const file of files) {
  const sourcePath = path.join(sourceDir, file);
  const targetPath = path.join(targetDir, file);
  
  if (file.endsWith('.json')) {
    const content = fs.readFileSync(sourcePath, 'utf8');
    const lines = content.split('\n');
    
    const readyIndex = lines.findIndex(line => line.includes('"text": "ready."'));
    
    if (readyIndex !== -1) {
      const newContent = lines.slice(0, readyIndex + 1).join('\n');
      fs.writeFileSync(targetPath, newContent, 'utf8');
      console.log(`Trimmed ${file}: kept segments after "ready."`);
    } else {
      fs.copyFileSync(sourcePath, targetPath);
      console.log(`Copied ${file}`);
    }
  } else {
    fs.copyFileSync(sourcePath, targetPath);
  }
}
```

### 4. 更新 .gitignore

添加 `screenshot-scripts/` 和 `output/screenshots/` 到忽略列表。

## 文件结构

```
English-Resource-Processing/
├── screenshot-scripts/
│   └── generate-screenshots.js
├── output/
│   └── screenshots/
│       └── video2/
├── transcription2/
└── .gitignore
```

是否开始实施？
